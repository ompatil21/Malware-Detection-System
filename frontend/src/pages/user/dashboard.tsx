import { useState, useEffect } from 'react';
import { useRouter } from 'next/router';
import axios from 'axios';

export default function UserDashboard() {
    const [user, setUser] = useState<{ username: string } | null>(null);
    const [message, setMessage] = useState('');
    const router = useRouter();

    useEffect(() => {
        const token = localStorage.getItem('token');

        if (!token) {
            router.push('/login'); // Redirect to login if no token found
        } else {
            axios
                .get('http://localhost:5000/api/dashboard', {
                    headers: { Authorization: `Bearer ${token}` }, // Pass token in Authorization header
                })
                .then((response) => {
                    setUser(response.data); // Set user data
                })
                .catch(() => {
                    setMessage('Error fetching user data. Please log in again.');
                    localStorage.removeItem('token'); // Clear invalid token
                    router.push('/login'); // Redirect to login
                });
        }
    }, [router]);

    return (
        <div className="min-h-screen flex items-center justify-center bg-gray-100">
            <div className="w-full max-w-4xl bg-white shadow-md rounded-lg p-8">
                <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">
                    User Dashboard
                </h1>
                {message ? (
                    <p className="text-red-500 text-center">{message}</p>
                ) : (
                    <div>
                        <p className="text-lg text-gray-700 mb-4">
                            Welcome, <span className="font-bold">{user?.username}</span>! This is your user dashboard.
                        </p>

                        {/* Add additional user information or stats here */}
                        <div className="grid grid-cols-2 gap-4">
                            <div className="p-4 bg-gray-100 rounded-lg shadow">
                                <h2 className="text-xl font-bold mb-2">Your Activities</h2>
                                <p className="text-gray-600">Activity details here...</p>
                            </div>
                            <div className="p-4 bg-gray-100 rounded-lg shadow">
                                <h2 className="text-xl font-bold mb-2">System Health</h2>
                                <p className="text-gray-600">Health stats here...</p>
                            </div>
                        </div>
                    </div>
                )}
            </div>
        </div>
    );
}
